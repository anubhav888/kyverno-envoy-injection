apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: envoy-sidecar-injection
  annotations:
    policies.kyverno.io/title: envoy-sidecar-injection
    policies.kyverno.io/subject: Pod
    policies.kyverno.io/description: >-
      Mutates selected pods by injecting envoy sidecar-proxy.       
spec:
  rules:
    - name: match-pod-label
      match:
        any:
        - resources:
            kinds:
            - namespace
            names:
            - nirmata
        - resources:
            kinds:
            - Pod
            selector:
              matchLabels:
                app: kafka
      mutate:
        patchStrategicMerge:
          spec:
            containers
            - name: envoy
              image: envoyproxy/envoy-alpine:v1.14.1
